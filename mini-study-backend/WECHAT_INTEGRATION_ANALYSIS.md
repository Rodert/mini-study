# å¾®ä¿¡å°ç¨‹åºé›†æˆåˆ†ææŠ¥å‘Š

## ğŸ“‹ å½“å‰æ¥å£æ¸…å•

### âœ… å·²æœ‰æ¥å£

#### ç”¨æˆ·ç›¸å…³
- âœ… `POST /api/v1/users/login` - ç”¨æˆ·ç™»å½•ï¼ˆå·¥å·+å¯†ç ï¼‰
- âœ… `POST /api/v1/users/register` - å‘˜å·¥æ³¨å†Œ
- âœ… `POST /api/v1/users/token/refresh` - åˆ·æ–°ä»¤ç‰Œ
- âœ… `PATCH /api/v1/users/me/profile` - ä¿®æ”¹ä¸ªäººä¿¡æ¯
- âœ… `GET /api/v1/users/managers` - æŸ¥è¯¢åº—é•¿åˆ—è¡¨

#### å†…å®¹ç›¸å…³
- âœ… `GET /api/v1/contents` - æŸ¥è¯¢å·²å‘å¸ƒå†…å®¹åˆ—è¡¨
- âœ… `GET /api/v1/contents/{id}` - æŸ¥è¯¢å†…å®¹è¯¦æƒ…
- âœ… `GET /api/v1/contents/categories` - æŸ¥è¯¢å†…å®¹åˆ†ç±»

#### å­¦ä¹ ç›¸å…³
- âœ… `GET /api/v1/learning` - æŸ¥è¯¢å­¦ä¹ è¿›åº¦åˆ—è¡¨
- âœ… `POST /api/v1/learning` - è®°å½•å­¦ä¹ è¿›åº¦
- âœ… `GET /api/v1/learning/{content_id}` - æŸ¥è¯¢æŒ‡å®šå†…å®¹çš„å­¦ä¹ è¿›åº¦

#### è½®æ’­å›¾
- âœ… `GET /api/v1/banners` - æŸ¥è¯¢å¯è§è½®æ’­å›¾

#### æ–‡ä»¶ä¸Šä¼ 
- âœ… `POST /api/v1/files/upload` - ä¸Šä¼ æ–‡ä»¶

---

## âŒ ç¼ºå¤±çš„å…³é”®æ¥å£

### 1. **è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯** âœ… å·²å®ç°
**æ¥å£**: `GET /api/v1/users/me`

**è¯´æ˜**: å°ç¨‹åºå¯åŠ¨æ—¶éœ€è¦è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨äºï¼š
- æ˜¾ç¤ºç”¨æˆ·å¤´åƒã€å§“å
- åˆ¤æ–­ç”¨æˆ·è§’è‰²ï¼ˆå‘˜å·¥/åº—é•¿/ç®¡ç†å‘˜ï¼‰
- æ˜¾ç¤ºå­¦ä¹ ç»Ÿè®¡ä¿¡æ¯

**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ
- Service å±‚: `UserService.GetCurrentUser()`
- Handler å±‚: `UserHandler.GetCurrentUser()`
- è·¯ç”±: `GET /api/v1/users/me` (éœ€è¦ Bearer Token)

**å½“å‰è¿”å›**:
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "work_no": "E001",
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "role": "employee",
    "status": true
  }
}
```

**æœªæ¥å¯æ‰©å±•å­—æ®µ**ï¼ˆå¯é€‰ï¼‰:
- `avatar_url`: ç”¨æˆ·å¤´åƒURL
- `learning_stats`: å­¦ä¹ ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»å­¦ä¹ æ—¶é•¿ã€å®Œæˆæ•°ç­‰ï¼‰

### 4. **åˆ†é¡µåŠŸèƒ½** âš ï¸ ä¸­ä¼˜å…ˆçº§
**é—®é¢˜**: æ‰€æœ‰åˆ—è¡¨æ¥å£éƒ½æ²¡æœ‰åˆ†é¡µå‚æ•°ï¼Œæ•°æ®é‡å¤§æ—¶ä¼šæœ‰æ€§èƒ½é—®é¢˜

**éœ€è¦æ·»åŠ åˆ†é¡µçš„æ¥å£**:
- `GET /api/v1/contents` - å†…å®¹åˆ—è¡¨
- `GET /api/v1/learning` - å­¦ä¹ è¿›åº¦åˆ—è¡¨
- `GET /api/v1/banners` - è½®æ’­å›¾åˆ—è¡¨ï¼ˆè™½ç„¶é€šå¸¸ä¸ä¼šå¤ªå¤šï¼‰

**å»ºè®®å‚æ•°**:
```go
// æŸ¥è¯¢å‚æ•°
{
  "page": 1,        // é¡µç ï¼Œä»1å¼€å§‹
  "page_size": 20,  // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
}

// å“åº”å¢åŠ åˆ†é¡µä¿¡æ¯
{
  "code": 200,
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "page_size": 20,
      "total": 100,
      "total_pages": 5
    }
  }
}
```

### 5. **å†…å®¹æœç´¢** âš ï¸ ä¸­ä¼˜å…ˆçº§
**æ¥å£**: `GET /api/v1/contents/search?keyword=xxx`

**è¯´æ˜**: å°ç¨‹åºä¸­ç”¨æˆ·å¯èƒ½éœ€è¦æœç´¢å†…å®¹

**å»ºè®®å®ç°**:
```go
// GET /api/v1/contents/search?keyword=åŸ¹è®­&page=1&page_size=20
// æ”¯æŒæŒ‰æ ‡é¢˜ã€æ‘˜è¦æœç´¢
```

### 6. **å­¦ä¹ ç»Ÿè®¡** âš ï¸ ä¸­ä¼˜å…ˆçº§
**æ¥å£**: `GET /api/v1/learning/stats`

**è¯´æ˜**: æ˜¾ç¤ºç”¨æˆ·çš„å­¦ä¹ ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚æ€»å­¦ä¹ æ—¶é•¿ã€å®Œæˆç‡ç­‰

**å»ºè®®å®ç°**:
```go
// GET /api/v1/learning/stats
{
  "code": 200,
  "data": {
    "total_learning_time": 7200,      // æ€»å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
    "total_learning_days": 15,        // å­¦ä¹ å¤©æ•°
    "completed_count": 10,            // å·²å®Œæˆå†…å®¹æ•°
    "in_progress_count": 5,            // è¿›è¡Œä¸­å†…å®¹æ•°
    "not_started_count": 3,           // æœªå¼€å§‹å†…å®¹æ•°
    "completion_rate": 55.6,           // å®Œæˆç‡ï¼ˆ%ï¼‰
    "today_learning_time": 3600,      // ä»Šæ—¥å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
    "weekly_learning_time": 18000      // æœ¬å‘¨å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
  }
}
```

### 7. **å†…å®¹æ”¶è—/ç‚¹èµ** âš ï¸ ä½ä¼˜å…ˆçº§
**è¯´æ˜**: å¦‚æœå°ç¨‹åºéœ€è¦æ”¶è—æˆ–ç‚¹èµåŠŸèƒ½

**å»ºè®®æ¥å£**:
- `POST /api/v1/contents/{id}/favorite` - æ”¶è—/å–æ¶ˆæ”¶è—
- `GET /api/v1/contents/favorites` - è·å–æ”¶è—åˆ—è¡¨
- `POST /api/v1/contents/{id}/like` - ç‚¹èµ/å–æ¶ˆç‚¹èµ

---

## ğŸ“ å­—æ®µç¼ºå¤±åˆ†æ

### UserResponse ç¼ºå°‘çš„å­—æ®µ
```go
type UserResponse struct {
    // ... ç°æœ‰å­—æ®µ
    AvatarURL string `json:"avatar_url"`        // ç”¨æˆ·å¤´åƒURL
    OpenID    string `json:"openid,omitempty"`  // å¾®ä¿¡OpenID
    UnionID   string `json:"unionid,omitempty"` // å¾®ä¿¡UnionIDï¼ˆå¯é€‰ï¼‰
}
```

### ContentResponse ç¼ºå°‘çš„å­—æ®µ
```go
type ContentResponse struct {
    // ... ç°æœ‰å­—æ®µ
    ViewCount    int64  `json:"view_count"`     // æŸ¥çœ‹æ¬¡æ•°
    LikeCount    int64  `json:"like_count"`      // ç‚¹èµæ•°ï¼ˆå¦‚æœæœ‰ç‚¹èµåŠŸèƒ½ï¼‰
    FavoriteCount int64 `json:"favorite_count"`  // æ”¶è—æ•°ï¼ˆå¦‚æœæœ‰æ”¶è—åŠŸèƒ½ï¼‰
    IsFavorite   bool   `json:"is_favorite"`     // å½“å‰ç”¨æˆ·æ˜¯å¦å·²æ”¶è—
    IsLiked     bool   `json:"is_liked"`        // å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµ
    LastViewedAt *time.Time `json:"last_viewed_at,omitempty"` // æœ€åæŸ¥çœ‹æ—¶é—´
}
```

### LearningProgressResponse ç¼ºå°‘çš„å­—æ®µ
```go
type LearningProgressResponse struct {
    // ... ç°æœ‰å­—æ®µ
    ContentTitle string `json:"content_title"`   // å†…å®¹æ ‡é¢˜ï¼ˆä¾¿äºæ˜¾ç¤ºï¼‰
    ContentType  string `json:"content_type"`    // å†…å®¹ç±»å‹
    CoverURL     string `json:"cover_url"`      // å°é¢å›¾
    LastStudyAt  *time.Time `json:"last_study_at,omitempty"` // æœ€åå­¦ä¹ æ—¶é—´
    TotalStudyTime int64 `json:"total_study_time"` // æ€»å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
}
```

### BannerResponse ç¼ºå°‘çš„å­—æ®µ
```go
type BannerResponse struct {
    // ... ç°æœ‰å­—æ®µ
    // å½“å‰å­—æ®µåŸºæœ¬å¤Ÿç”¨ï¼Œä½†å¯ä»¥è€ƒè™‘æ·»åŠ ï¼š
    ClickCount int64 `json:"click_count"` // ç‚¹å‡»æ¬¡æ•°ï¼ˆç»Ÿè®¡ç”¨ï¼‰
}
```

---

## ğŸ¯ ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®ç°ï¼‰
1. âœ… **è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯** - `GET /api/v1/users/me` âœ… å·²å®Œæˆ
2. âšª **å¾®ä¿¡å°ç¨‹åºç™»å½•** - ä¸éœ€è¦ï¼ˆä½¿ç”¨è´¦å·å¯†ç ç™»å½•ï¼‰
3. âšª **ç»‘å®šå·¥å·æ¥å£** - ä¸éœ€è¦ï¼ˆä½¿ç”¨è´¦å·å¯†ç ç™»å½•ï¼‰

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®ç°ï¼‰
4. âœ… **åˆ†é¡µåŠŸèƒ½** - ä¸ºåˆ—è¡¨æ¥å£æ·»åŠ åˆ†é¡µå‚æ•°
5. âœ… **å†…å®¹æœç´¢** - `GET /api/v1/contents/search`
6. âœ… **å­¦ä¹ ç»Ÿè®¡** - `GET /api/v1/learning/stats`
7. âœ… **ç”¨æˆ·å¤´åƒå­—æ®µ** - åœ¨ UserResponse ä¸­æ·»åŠ  avatar_url

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰å®ç°ï¼‰
8. âšª **æ”¶è—åŠŸèƒ½** - å¦‚æœäº§å“éœ€è¦
9. âšª **ç‚¹èµåŠŸèƒ½** - å¦‚æœäº§å“éœ€è¦
10. âšª **å†…å®¹æŸ¥çœ‹ç»Ÿè®¡** - view_count ç­‰å­—æ®µ

---

## ğŸ“± å°ç¨‹åºé›†æˆæµç¨‹å»ºè®®

### 1. é¦–æ¬¡å¯åŠ¨æµç¨‹
```
å°ç¨‹åºå¯åŠ¨
  â†“
æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ token
  â†“
æœ‰ token? â†’ è°ƒç”¨ GET /api/v1/users/me éªŒè¯
  â†“
token æœ‰æ•ˆ? â†’ è¿›å…¥ä¸»é¡µ
  â†“
token æ— æ•ˆ? â†’ æ˜¾ç¤ºç™»å½•é¡µé¢
```

### 2. ç™»å½•æµç¨‹ï¼ˆè´¦å·å¯†ç ç™»å½•ï¼‰
```
ç”¨æˆ·ç‚¹å‡»ç™»å½•
  â†“
ç”¨æˆ·è¾“å…¥å·¥å·+å¯†ç 
  â†“
è°ƒç”¨ POST /api/v1/users/login
  â†“
ç™»å½•æˆåŠŸï¼Œè¿”å› token
  â†“
ä¿å­˜ token åˆ°æœ¬åœ°å­˜å‚¨
  â†“
è¿›å…¥ä¸»é¡µ
```

### 3. å†…å®¹æµè§ˆæµç¨‹
```
è¿›å…¥å†…å®¹åˆ—è¡¨é¡µ
  â†“
è°ƒç”¨ GET /api/v1/contents?page=1&page_size=20
  â†“
æ˜¾ç¤ºå†…å®¹åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰
  â†“
ç‚¹å‡»å†…å®¹
  â†“
è°ƒç”¨ GET /api/v1/contents/{id} è·å–è¯¦æƒ…
  â†“
è°ƒç”¨ GET /api/v1/learning/{content_id} è·å–å­¦ä¹ è¿›åº¦
  â†“
æ’­æ”¾è§†é¢‘ï¼Œå®šæœŸè°ƒç”¨ POST /api/v1/learning æ›´æ–°è¿›åº¦
```

---

## ğŸ”§ æŠ€æœ¯å®ç°å»ºè®®

### 1. åˆ†é¡µå®ç°
- å»ºè®®ç»Ÿä¸€çš„åˆ†é¡µå“åº”ç»“æ„
- ä½¿ç”¨ GORM çš„ `Offset` å’Œ `Limit` å®ç°
- æ·»åŠ ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

### 2. å­—æ®µæ‰©å±•
- æ•°æ®åº“è¡¨å¯èƒ½éœ€è¦æ·»åŠ æ–°å­—æ®µï¼ˆå¦‚ openid, avatar_url ç­‰ï¼‰
- è€ƒè™‘æ•°æ®è¿ç§»è„šæœ¬

---

## ğŸ“Š æ€»ç»“

**å½“å‰æ¥å£è¦†ç›–åº¦**: çº¦ 75%

**å·²å®Œæˆ**:
1. âœ… è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯æ¥å£ - `GET /api/v1/users/me`

**æ ¸å¿ƒç¼ºå¤±**:
1. åˆ†é¡µåŠŸèƒ½ï¼ˆåˆ—è¡¨æ¥å£ï¼‰
2. å†…å®¹æœç´¢æ¥å£
3. å­¦ä¹ ç»Ÿè®¡æ¥å£

**ç™»å½•æ–¹å¼**: ä½¿ç”¨è´¦å·å¯†ç ç™»å½•ï¼ˆå·¥å·+å¯†ç ï¼‰ï¼Œä¸éœ€è¦å¾®ä¿¡ç™»å½•

**å»ºè®®ä¼˜å…ˆå®ç°ä¸­ä¼˜å…ˆçº§æ¥å£ï¼ˆåˆ†é¡µã€æœç´¢ã€ç»Ÿè®¡ï¼‰ï¼Œç„¶åæ ¹æ®å°ç¨‹åºå®é™…ä½¿ç”¨æƒ…å†µè¡¥å……ä½ä¼˜å…ˆçº§åŠŸèƒ½ã€‚**

