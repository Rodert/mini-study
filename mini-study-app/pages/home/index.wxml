<view class="home-page">
  <!-- 顶部欢迎栏 -->
  <view class="welcome-bar">
    <view class="welcome-content">
      <view class="welcome-greeting">
        <text class="greeting-icon">👋</text>
        <view>
          <view class="greeting-text">你好，{{user.name || '未登录'}}</view>
          <view class="greeting-time">{{currentTime}}</view>
        </view>
      </view>
      <view class="header-buttons">
        <view class="header-btn" wx:if="{{user.role === 'admin'}}" bindtap="goUserManagement">
          <text class="btn-icon">👥</text>
        </view>
        <view class="header-btn" bindtap="goProfile">
          <text class="btn-icon">👤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 系统公告横幅（非管理员，存在最新公告时展示） -->
  <view class="section notice-banner-section" wx:if="{{latestNotice && user.role !== 'admin'}}">
    <view class="notice-banner-card" bindtap="goNoticeList">
      <view class="notice-inline-list">
        <view class="notice-inline-item">
          <view class="notice-inline-main">
            <view class="notice-inline-title">
              <text class="notice-inline-tag">重要</text>
              <text>{{latestNotice.title}}</text>
            </view>
            <view class="notice-inline-meta">系统公告 · 点击查看详情</view>
          </view>
          <text class="notice-inline-arrow">›</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 企业资讯（非管理员显示） -->
  <view class="section" wx:if="{{user.role !== 'admin'}}">
    <view class="section-header">
      <view class="section-title-group">
        <text class="section-icon">📢</text>
        <view>
          <view class="section-title">企业资讯</view>
          <view class="section-subtitle">最新培训公告 / 资讯</view>
        </view>
      </view>
      <button class="btn-refresh" bindtap="reloadBanners">🔄</button>
    </view>
    
    <view class="banner-card" wx:if="{{banners.length}}">
      <swiper circular autoplay interval="5000" indicator-dots>
        <block wx:for="{{banners}}" wx:key="id">
          <swiper-item>
            <view class="banner-item {{item.url ? 'banner-clickable' : ''}}" bindtap="handleBannerTap" data-item="{{item}}">
              <image class="banner-img" src="{{item.cover}}" mode="aspectFill" />
              <view class="banner-mask">
                <view class="banner-content">
                  <text class="banner-title">{{item.title}}</text>
                  <view class="banner-tag">{{item.type}}</view>
                  <view class="banner-link-hint" wx:if="{{item.url}}">点击查看详情 →</view>
                </view>
              </view>
            </view>
          </swiper-item>
        </block>
      </swiper>
    </view>
  </view>

  <!-- 员工列表（管理员显示） -->
  <view class="section admin-actions" wx:if="{{user.role === 'admin'}}">
    <view class="section-title-group">
      <text class="section-icon">👥</text>
      <view>
        <view class="section-title">员工管理</view>
        <view class="section-subtitle">查看和管理所有员工</view>
      </view>
    </view>

    <view class="admin-action-grid">
      <view class="admin-action-card" bindtap="goEmployeesList">
        <view class="action-icon">📋</view>
        <view class="action-title">员工列表</view>
        <view class="action-desc">查看和管理所有员工</view>
        <view class="action-arrow">→</view>
      </view>
    </view>
  </view>

  <!-- 管理员快捷操作 -->
  <view class="section admin-actions" wx:if="{{user.role === 'admin'}}">
    <view class="section-title-group">
      <text class="section-icon">⚙️</text>
      <view>
        <view class="section-title">管理入口</view>
        <view class="section-subtitle">轮播 & 学习内容</view>
      </view>
    </view>

    <view class="admin-action-grid">
      <view class="admin-action-card" bindtap="goBannerManagement">
        <view class="action-icon">🖼️</view>
        <view class="action-title">轮播管理</view>
        <view class="action-desc">配置首页轮播</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goCategoryManagement">
        <view class="action-icon">🏷️</view>
        <view class="action-title">分类管理</view>
        <view class="action-desc">设置课程分类封面</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goNoticeManagement">
        <view class="action-icon">📢</view>
        <view class="action-title">公告管理</view>
        <view class="action-desc">编辑系统公告</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goContentCreate">
        <view class="action-icon">➕</view>
        <view class="action-title">新增学习内容</view>
        <view class="action-desc">上传培训资料</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goExamManagement">
        <view class="action-icon">📝</view>
        <view class="action-title">考试管理</view>
        <view class="action-desc">创建和管理考试</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goAdminProgress">
        <view class="action-icon">📊</view>
        <view class="action-title">考核进度</view>
        <view class="action-desc">查看全员进度</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goGrowthManagement">
        <view class="action-icon">🌱</view>
        <view class="action-title">成长圈审核</view>
        <view class="action-desc">查看并审核成长圈动态</view>
        <view class="action-arrow">→</view>
      </view>

      <view class="admin-action-card" bindtap="goPointsManagement">
        <view class="action-icon">⭐</view>
        <view class="action-title">积分管理</view>
        <view class="action-desc">查看所有用户积分</view>
        <view class="action-arrow">→</view>
      </view>
    </view>
  </view>

  <!-- 学习入口（管理员不显示） -->
  <view class="section" wx:if="{{user.role !== 'admin'}}">
    <view class="section-title-group">
      <text class="section-icon">📚</text>
      <view>
        <view class="section-title">学习入口</view>
        <view class="section-subtitle">选择课程开始学习</view>
      </view>
    </view>

    <view class="entry-grid">
      <view
        class="entry-card"
        wx:for="{{categories}}"
        wx:key="id"
        bindtap="handleSelectCategory"
        data-item="{{item}}"
      >
        <view class="entry-inner">
          <view class="entry-title">{{item.name}}</view>
          <view class="entry-desc">{{item.count || 0}} 门课程</view>
          <view class="entry-arrow">›</view>
        </view>
        <view class="entry-cover">
          <block wx:if="{{item.cover}}">
            <image class="entry-cover-img" src="{{item.cover}}" mode="aspectFill" />
          </block>
          <block wx:else>
            <view class="entry-cover-placeholder"></view>
          </block>
        </view>
      </view>

      <view
        class="entry-card exam-entry"
        bindtap="goExamList"
        wx:if="{{user.role !== 'admin'}}"
      >
        <view class="entry-inner">
          <view class="entry-title">考试中心</view>
          <view class="entry-desc">参加考核 · 查看成绩</view>
          <view class="entry-arrow">›</view>
        </view>
        <view class="entry-cover">
          <image
            class="entry-cover-img"
            src="https://img2024.cnblogs.com/blog/1326459/202512/1326459-20251221223440165-943226619.png"
            mode="aspectFill"
          />
        </view>
      </view>

      <view class="entry-card manager-card" bindtap="goProgress" wx:if="{{user.role === 'manager'}}">
        <view class="entry-inner">
          <view class="manager-badge-row">
            <text class="manager-badge">店长专属</text>
          </view>
          <view class="entry-title">考核进度</view>
          <view class="entry-desc">查看团队整体考核情况</view>
          <view class="entry-arrow">›</view>
        </view>
        <view class="entry-cover">
          <image
            class="entry-cover-img"
            src="https://img2024.cnblogs.com/blog/1326459/202512/1326459-20251221223425702-1126940807.png"
            mode="aspectFill"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- 底部空间 -->
  <view class="bottom-space"></view>

  <!-- 系统公告弹窗 -->
  <view wx:if="{{noticeModalVisible}}" class="notice-mask">
    <view class="notice-dialog">
      <view class="notice-header">
        <text class="notice-title">{{latestNotice.title}}</text>
      </view>
      <scroll-view scroll-y="true" class="notice-body">
        <image wx:if="{{latestNotice.imageUrl}}" class="notice-image" src="{{latestNotice.imageUrl}}" mode="widthFix" />
        <text wx:if="{{latestNotice.content}}" class="notice-content">{{latestNotice.content}}</text>
      </scroll-view>
      <button class="btn-primary notice-confirm" bindtap="handleNoticeClose">我知道了</button>
    </view>
  </view>
</view>

