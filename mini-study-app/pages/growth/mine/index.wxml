<!--pages/growth/mine/index.wxml-->
<view class="mine-page">
  <view class="top-bar">
    <view class="back-button" bindtap="goBack">
      <text>â†</text>
    </view>
    <view class="top-title">æˆ‘çš„æˆé•¿åœˆ</view>
    <view class="top-placeholder"></view>
  </view>

  <!-- å‘å¸ƒåŒºåŸŸï¼ˆä»…åº—é•¿å¯è§ï¼‰ -->
  <view class="publish-card" wx:if="{{user.role === 'manager'}}">
    <view class="publish-title">å‘å¸ƒæˆé•¿åœˆ</view>
    <textarea
      class="publish-input"
      placeholder="åˆ†äº«é—¨åº—æ—¥å¸¸ã€ç»éªŒæˆ–è¡¨æ‰¬å‘˜å·¥..."
      value="{{form.content}}"
      auto-height
      maxlength="1000"
      bindinput="handleContentInput"
    />
    <view class="image-preview" wx:if="{{imagePreviewList && imagePreviewList.length}}">
      <image
        class="preview-image"
        wx:for="{{imagePreviewList}}"
        wx:key="{{index}}"
        src="{{item}}"
        mode="aspectFill"
      />
    </view>
    <view class="publish-actions">
      <button class="btn-secondary" bindtap="handleChooseImages" loading="{{uploading}}" disabled="{{uploading}}">
        {{uploading ? 'ä¸Šä¼ ä¸­...' : 'æ·»åŠ å›¾ç‰‡'}}
      </button>
      <button class="btn-primary" bindtap="handleSubmit">å‘å¸ƒ</button>
    </view>
  </view>

  <!-- ç­›é€‰ä¸æœç´¢ -->
  <view class="filters">
    <view class="filter-item">
      <view class="filter-label">çŠ¶æ€</view>
      <picker
        class="picker"
        mode="selector"
        range="{{statusFilterOptions}}"
        range-key="label"
        value="{{statusFilterIndex}}"
        bindchange="handleStatusChange"
      >
        <view class="picker-value">
          {{statusFilterOptions[statusFilterIndex].label}}
        </view>
      </picker>
    </view>
    <view class="filter-item">
      <view class="filter-label">æœç´¢</view>
      <view class="search-input-wrapper">
        <input
          class="search-input"
          type="text"
          placeholder="æŒ‰å†…å®¹æœç´¢"
          value="{{keyword}}"
          bindinput="handleSearchInput"
          confirm-type="search"
          bindconfirm="handleSearchConfirm"
        />
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„åŠ¨æ€åˆ—è¡¨ -->
  <scroll-view class="post-list" scroll-y="true">
    <view class="post-card" wx:for="{{posts}}" wx:key="id">
      <view class="post-header">
        <view class="avatar">{{item.avatarText}}</view>
        <view class="post-header-info">
          <view class="publisher-name">{{item.publisherName || 'æˆ‘'}}</view>
          <view class="post-meta-row">
            <view class="post-meta">{{item.createdAtText}}</view>
            <view class="status-tag {{item.status}}">{{item.statusText}}</view>
          </view>
        </view>
      </view>
      <view class="post-content">{{item.content}}</view>
      <view class="image-grid" wx:if="{{item.images && item.images.length}}">
        <view
          class="post-image-wrapper"
          wx:for="{{item.images}}"
          wx:for-index="imgIndex"
          wx:key="{{imgIndex}}"
          data-post-index="{{index}}"
          data-image-index="{{imgIndex}}"
          bindtap="handlePreviewImage"
        >
          <image
            class="post-image"
            src="{{item}}"
            mode="aspectFill"
          />
        </view>
      </view>
      <view class="post-actions">
        <button class="btn-copy-small" data-index="{{index}}" bindtap="handleCopyAndDownload">
          <text class="btn-copy-icon">ğŸ“‹</text>
        </button>
        <button
          class="btn-danger"
          wx:if="{{item.status !== 'approved'}}"
          data-id="{{item.id}}"
          bindtap="handleDelete"
        >åˆ é™¤</button>
      </view>
    </view>

    <view class="empty-state" wx:if="{{!loading && (!posts || !posts.length)}}">
      <text>æš‚æ— æˆé•¿åœˆåŠ¨æ€</text>
    </view>
  </scroll-view>
</view>