<view class="progress-page">
  <!-- ç­›é€‰åŒº -->
  <view class="section filter-section">
    <view class="section-header">
      <view class="section-title-group">
        <text class="section-icon">ğŸ“Š</text>
        <view>
          <view class="section-title">è€ƒæ ¸è¿›åº¦æ€»è§ˆ</view>
          <view class="section-subtitle">æŸ¥çœ‹å…¨å‘˜è€ƒè¯•ä¸å­¦ä¹ è¿›åº¦</view>
        </view>
      </view>
    </view>

    <view class="filter-row">
      <view class="filter-item">
        <text class="filter-label">è§’è‰²</text>
        <picker mode="selector" range="{{roles}}" range-key="label" value="{{roleIndex}}" bindchange="handleRoleChange">
          <view class="filter-picker">
            <text>{{roles[roleIndex].label}}</text>
          </view>
        </picker>
      </view>
    </view>

    <view class="filter-row keyword-row">
      <view class="filter-item flex-1">
        <text class="filter-label">å…³é”®å­—</text>
        <input class="filter-input" placeholder="å·¥å· / å§“å / æ‰‹æœºå·" value="{{filters.keyword}}" bindinput="handleKeywordInput" />
      </view>
      <button class="btn-primary small" bindtap="handleSearch">æŸ¥è¯¢</button>
    </view>
  </view>

  <!-- è€ƒè¯•è¿›åº¦éƒ¨åˆ† -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-group">
        <text class="section-icon">ğŸ“</text>
        <view>
          <view class="section-title">è€ƒè¯•è¿›åº¦</view>
          <view class="section-subtitle">å½“å‰ç­›é€‰èŒƒå›´å†…å„è€ƒè¯•é€šè¿‡ç‡</view>
        </view>
      </view>
    </view>

    <view class="grid auto-fit" wx:if="{{examProgress.length}}">
      <view class="card progress-card" wx:for="{{examProgress}}" wx:key="id">
        <view class="progress-card-header">
          <view class="progress-icon">ğŸ“„</view>
          <text class="course-title">{{item.title}}</text>
        </view>
        <view class="progress-bar-wrapper">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.passRate}}%;"></view>
          </view>
          <text class="progress-percent">{{item.passRate}}%</text>
        </view>
        <view class="progress-meta">
          <view class="meta-item">
            <text class="meta-label">é€šè¿‡ç‡</text>
            <text class="meta-value">{{item.passRate}}%</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">å¹³å‡åˆ†</text>
            <text class="meta-value">{{item.avgScore}} åˆ†</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">å‚è€ƒäººæ•°</text>
            <text class="meta-value">{{item.attemptCount}} äºº</text>
          </view>
        </view>
      </view>
    </view>
    <view class="empty-block" wx:else>
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è€ƒè¯•æ•°æ®</text>
    </view>
  </view>

  <!-- ç”¨æˆ·å®Œæˆæƒ…å†µéƒ¨åˆ† -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-group">
        <text class="section-icon">ğŸ‘¥</text>
        <view>
          <view class="section-title">äººå‘˜å®Œæˆæƒ…å†µ</view>
          <view class="section-subtitle">å½“å‰ç­›é€‰èŒƒå›´å†…çš„å­¦ä¹ ä¸è€ƒè¯•è¿›åº¦</view>
        </view>
      </view>
    </view>

    <view wx:if="{{users.length}}">
      <view class="card employee-card" wx:for="{{users}}" wx:key="id">
        <view class="employee-header">
          <view class="employee-info-group">
            <view class="employee-avatar">{{item.avatar}}</view>
            <view class="employee-info">
              <text class="employee-name">{{item.name}}</text>
              <text class="employee-store">å·¥å·ï¼š{{item.workNo}} Â· è§’è‰²ï¼š{{item.role}}</text>
            </view>
          </view>
          <view class="employee-percent-badge">
            <text class="employee-percent">{{item.percent}}%</text>
          </view>
        </view>

        <view class="progress-bar-wrapper">
          <view class="progress-bar small">
            <view class="progress-fill" style="width: {{item.percent}}%;"></view>
          </view>
        </view>

        <view class="employee-stats">
          <view class="stat-item">
            <text class="stat-label">å·²å®Œæˆ</text>
            <text class="stat-value highlight">{{item.completed}}/{{item.total}}</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-label">å¾…è¡¥</text>
            <text class="stat-value warning">{{item.pending}}</text>
          </view>
        </view>

        <view class="exam-info" wx:if="{{item.latestExam}}">
          <view class="exam-info-header">
            <text class="exam-label">æœ€æ–°æˆç»©</text>
            <view class="exam-score-badge {{item.latestExam.pass ? 'pass' : 'fail'}}">
              <text>{{item.latestExam.score}} åˆ†</text>
            </view>
          </view>
          <view class="exam-details">
            <text class="exam-title">{{item.latestExam.examTitle}}</text>
            <text class="exam-status {{item.latestExam.pass ? 'text-pass' : 'text-fail'}}">
              {{item.latestExam.pass ? 'âœ“ åŠæ ¼' : 'âœ— æœªåŠæ ¼'}}
            </text>
          </view>
        </view>
        <view class="exam-info empty" wx:else>
          <text class="exam-empty-text">å°šæœªå‚åŠ è€ƒè¯•</text>
        </view>
      </view>

      <!-- åˆ†é¡µåŒºåŸŸ -->
      <view class="pagination-bar">
        <button class="btn-secondary small" bindtap="handlePrevPage" disabled="{{pagination.page <= 1}}">ä¸Šä¸€é¡µ</button>
        <text class="pagination-text">ç¬¬ {{pagination.page}} / {{pagination.maxPage}} é¡µ Â· å…± {{pagination.total}} äºº</text>
        <button class="btn-secondary small" bindtap="handleNextPage" disabled="{{pagination.page >= pagination.maxPage}}">ä¸‹ä¸€é¡µ</button>
      </view>
    </view>
    <view class="empty-block" wx:else>
      <text class="empty-icon">ğŸ‘¤</text>
      <text class="empty-text">æš‚æ— äººå‘˜ç»Ÿè®¡</text>
    </view>
  </view>

  <!-- åº•éƒ¨ç©ºé—´ -->
  <view class="bottom-space"></view>
</view>
